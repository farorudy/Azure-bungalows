<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulaire de r√©servation</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="icon" href="/favicon.ico" />
  <!-- SDK PayPal -->
  <script src="https://www.paypal.com/sdk/js?client-id=AFcWxV21C7fd0v3bYYYRCpSSRl31AKAsF3zYYsXjhXBQAT9kkmkwtoAu&currency=EUR"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìù R√©server un bungalow</h1>
      <p>Veuillez remplir le formulaire ci-dessous</p>
    </header>

    <form id="paypal-form" action="/submit-reservation" method="POST">
      <div class="form-group">
        <label for="name">Nom complet</label>
        <input type="text" id="name" name="name" required style="width:100%; padding:10px; margin:10px 0; border:1px solid #ddd; border-radius:8px;">
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required style="width:100%; padding:10px; margin:10px 0; border:1px solid #ddd; border-radius:8px;">
      </div>

      <div class="form-group">
        <label for="bungalow">Bungalow souhait√©</label>
        <select id="bungalow" name="bungalow" required style="width:100%; padding:10px; margin:10px 0; border:1px solid #ddd; border-radius:8px;">
          <option value="Bungalow 1">Bungalow 1 (Vue lac)</option>
          <option value="Bungalow 2">Bungalow 2 (For√™t)</option>
          <option value="Bungalow 3">Bungalow 3 (Familial)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="dates">Dates souhait√©es</label>
        <input type="text" id="dates" name="dates" placeholder="ex: 10-15 juillet" required style="width:100%; padding:10px; margin:10px 0; border:1px solid #ddd; border-radius:8px;">
      </div>

      <button type="submit" class="btn">Envoyer la demande</button>
    </form>

    <!-- Bouton PayPal -->
    <div id="paypal-button-container" style="margin-top: 24px;"></div>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        if (window.paypal) {
          paypal.Buttons({
            onClick: function(data, actions) {
              const form = document.getElementById('paypal-form');
              const formData = new FormData(form);
              // Adapter le nom des champs pour l'API backend
              const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                dates: formData.get('dates'),
                bungalowId: formData.get('bungalow') // correspond √† l'id attendu c√¥t√© serveur
              };
              return fetch('/create-paypal-payment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
              })
              .then(res => res.json())
              .then(result => {
                if (result.redirect) {
                  window.location.href = result.redirect;
                } else {
                  alert("Erreur lors de la cr√©ation du paiement PayPal.");
                }
              });
            },
            createOrder: function() { return false; },
            onError: function(err) {
              alert("Erreur PayPal : " + err);
            }
          }).render('#paypal-button-container');
        }
      });
    </script>

    <footer>
      <p><a href="/">‚Üê Retour √† la disponibilit√©</a></p>
    </footer>
  </div>
</body>
</html>
